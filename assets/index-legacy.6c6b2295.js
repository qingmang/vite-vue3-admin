System.register(["./index-legacy.2fcb676e.js","./index-legacy.85f666eb.js","./dynamic-table-legacy.5a1652bb.js","./useFormModal-legacy.0f7e927a.js","./utils-legacy.76523550.js","./vendor-legacy.38f67009.js","./index-legacy.db1a9531.js"],(function(e){"use strict";var a,l,t,n,d,i,o,r,s,c,u,p,m,f,h,b,y,v,g,x;return{setters:[function(e){a=e.b,l=e.e,t=e.f,n=e.a,d=e.h,i=e.i},function(e){o=e.g},function(e){r=e.D},function(e){s=e.u},function(e){c=e.b,u=e.a},function(e){p=e.d,m=e.r,f=e.x,h=e.b,b=e.c,y=e.y,v=e.z,g=e.Q,x=e.h},function(){}],execute:function(){const I=[{title:"#",dataIndex:"id",width:55,align:"center",hideInSearch:!0},{title:"名称",width:200,align:"center",dataIndex:"name"},{title:"标识",width:80,align:"center",dataIndex:"label"},{title:"备注",dataIndex:"remark",align:"center"},{title:"创建时间",dataIndex:"createdAt",align:"center",hideInSearch:!0},{title:"更新时间",align:"center",dataIndex:"updatedAt",hideInSearch:!0}],k=[{field:"name",component:"Input",label:"名称",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"label",component:"Input",label:"标识",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"menus",component:"Tree",label:"菜单权限",colProps:{span:12},componentProps:{checkable:!0,vModelKey:"checkedKeys",style:{height:"350px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6"}}},{field:"depts",component:"Tree",label:"部门权限",colProps:{span:12},componentProps:{checkable:!0,vModelKey:"checkedKeys",style:{height:"350px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6"}}}],w=x(" 新增 ");e("default",p({name:"SystemPermissionRole",setup(e){const p=m(),[x]=s(),P=(e,a,l=[])=>a.reduce(((a,t)=>{var n;return null!==(n=t.children)&&void 0!==n&&n.length?P(e,t.children,l):e.includes(t.value)&&a.push(t.value),a}),l),K=async e=>{var a;const[i]=await x({modalProps:{title:(e.id?"编辑":"新增")+"角色",width:"50%",onFinish:async a=>{var n,d,o,r,s;e.id&&(a.roleId=e.id);const c=null===(n=i.value)||void 0===n||null===(d=n.compRefs)||void 0===d?void 0:d.menus,u=null===(o=i.value)||void 0===o||null===(r=o.compRefs)||void 0===r?void 0:r.depts,m={...a,menus:[...c.halfCheckedKeys,...c.checkedKeys],depts:[...u.halfCheckedKeys,...u.checkedKeys]};await(e.id?l:t)(m),null===(s=p.value)||void 0===s||s.refreshTable()}},formSchema:{labelWidth:100,layout:"vertical",schemas:k}}),[r,s]=await Promise.all([n(),o()]),m=c(s),f=u(r);if(null===(a=i.value)||void 0===a||a.updateSchema([{field:"menus",componentProps:{treeData:m}},{field:"depts",componentProps:{treeData:f}}]),e.id){var h;const a=await d({roleId:e.id}),l=a.menus.map((e=>e.menuId)),t=a.depts.map((e=>e.departmentId));null===(h=i.value)||void 0===h||h.setFieldsValue({...e,name:a.roleInfo.name,label:a.roleInfo.label,remark:a.roleInfo.remark,menus:P(l,m),depts:P(t,f)})}},S=[...I,{title:"操作",width:160,dataIndex:"$action",hideInSearch:!0,align:"center",fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"sys.role.update",effect:"disable"},onClick:()=>K(e)},{label:"删除",auth:"sys.role.delete",popConfirm:{title:"你确定要删除吗？",onConfirm:()=>(async e=>{var a;await i({roleIds:[e.id]}),null===(a=p.value)||void 0===a||a.refreshTable()})(e)}}]}];return(e,l)=>{const t=f("a-button");return h(),b("div",null,[y(g(r),{ref_key:"dynamicTableRef",ref:p,"row-key":"id","header-title":"角色管理","data-request":g(a),columns:S,bordered:"",size:"small"},{toolbar:v((()=>[y(t,{type:"primary",disabled:!e.$auth("sys.role.add"),onClick:l[0]||(l[0]=e=>K({}))},{default:v((()=>[w])),_:1},8,["disabled"])])),_:1},8,["data-request"])])}}}))}}}));
