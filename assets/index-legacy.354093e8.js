!function(){var e=document.createElement("style");e.innerHTML=".split-wrapper{display:flex;width:100%;height:100%;background-color:#fff}.split-wrapper .scalable{position:relative;width:240px;max-width:50vw;min-width:100px;overflow:auto}.split-wrapper .scalable .left-content{height:100%;padding:12px 20px 12px 12px}.split-wrapper .scalable .separator{position:absolute;top:0;right:0;display:flex;width:14px;height:100%;cursor:col-resize;background-color:#fff;box-shadow:-4px -2px 4px -5px rgba(0,0,0,.35),4px 3px 4px -5px rgba(0,0,0,.35);align-items:center;justify-content:center}.split-wrapper .scalable .separator i{width:1px;height:14px;margin:0 1px;background-color:#e9e9e9}.split-wrapper .right-content{flex:1}.split-wrapper .left-content,.split-wrapper .right-content{overflow:auto}\n",document.head.appendChild(e),System.register(["./vendor-legacy.38f67009.js","./dynamic-table-legacy.5a1652bb.js","./index-legacy.db1a9531.js","./index-legacy.2fcb676e.js","./useFormModal-legacy.0f7e927a.js","./utils-legacy.76523550.js"],(function(e){"use strict";var t,a,l,n,d,o,r,s,i,u,c,p,m,f,y,h,v,b,w,g,x,I,k,C,P,S,T,K,_,E,j,q,R,$,N,F,D,M,V,A,L,O,W,U,X,z;return{setters:[function(e){t=e.d,a=e.r,l=e.av,n=e.b,d=e.c,o=e.e,r=e.a9,s=e.h,i=e.y,u=e.X,c=e.by,p=e.bK,m=e.aq,f=e.k,y=e.l,h=e.x,v=e.A,b=e.z,w=e.Q,g=e.aI,x=e.bQ,I=e.C,k=e.bR,C=e.aY,P=e.ad,S=e.bS,T=e.bT,K=e.t,_=e.aA,E=e.a6,j=e.bx,q=e.bU,R=e.N,$=e.bV},function(e){N=e.D},function(e){F=e.y,D=e.B},function(e){M=e.g,V=e.u,A=e.c,L=e.t,O=e.d,W=e.a},function(e){U=e.u},function(e){X=e.f,z=e.a}],execute:function(){const Q={class:"split-wrapper"},B={class:"left-content"},G=s(" 右边内容区 "),H=[o("i",null,null,-1),o("i",null,null,-1)],Y={class:"right-content"},J=s(" 右边内容区 ");var Z=t({setup(e){const t=a();let s,i;const u=l((function(e){t.value&&(t.value.style.width=i+e.clientX-s+"px")}),20),c=()=>{document.documentElement.style.userSelect="unset",document.documentElement.removeEventListener("mousemove",u),document.documentElement.removeEventListener("mouseup",c)},p=e=>{s=e.clientX,t.value&&(i=parseInt(window.getComputedStyle(t.value).width,10)),document.documentElement.style.userSelect="none",document.documentElement.addEventListener("mousemove",u),document.documentElement.addEventListener("mouseup",c)};return(e,a)=>(n(),d("div",Q,[o("div",{ref_key:"scalable",ref:t,class:"scalable"},[o("div",B,[r(e.$slots,"left-content",{},(()=>[G]))]),o("div",{ref:"separator",class:"separator",onMousedown:p},H,544)],512),o("div",Y,[r(e.$slots,"right-content",{},(()=>[J]))])]))}});function ee(e){return F({url:D.add,method:"post",data:e},{successMsg:"创建用户成功"})}function te(e){return F({url:D.update,method:"post",data:e},{successMsg:"修改用户成功"})}function ae(e){return F({url:D.delete,method:"post",data:e})}const le=[{field:"name",component:"Input",label:"部门名称",rules:[{required:!0,type:"string"}]},{field:"parentId",component:"TreeSelect",label:"上级部门",componentProps:{getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"orderNum",component:"InputNumber",label:"排序号",defaultValue:255,componentProps:{style:{width:"100%"}}}],ne=[{field:"departmentId",component:"TreeSelect",label:"所属部门",componentProps:{getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"roles",component:"Select",label:"所属角色",rules:[{required:!0,type:"array"}],componentProps:{mode:"multiple",request:async()=>(await M()).map((e=>({label:e.name,value:e.id})))}},{field:"username",component:"Input",label:"用户名",rules:[{required:!0}]},{field:"name",component:"Input",label:"姓名",colProps:{span:12},rules:[{required:!0}]},{field:"nickName",component:"Input",label:"呢称",colProps:{span:12}},{field:"email",component:"Input",label:"邮箱",colProps:{span:12}},{field:"phone",component:"Input",label:"手机",colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"status",component:"RadioGroup",label:"状态",defaultValue:1,componentProps:{options:[{label:"启用",value:1},{label:"禁用",value:0}]}}],de=[{field:"password",component:"Input",label:"新密码",rules:[{required:!0,type:"string"}]}],oe=[{field:"departmentId",component:"TreeSelect",label:"转移至",rules:[{required:!0,type:"number"}]}];function re(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!p(e)}const se=[{title:"头像",width:80,dataIndex:"headImg",hideInSearch:!0,bodyCell:({record:e})=>i(u,{src:e.headImg},null)},{title:"姓名",width:120,dataIndex:"name",align:"center"},{title:"用户名",width:120,align:"center",dataIndex:"username"},{title:"所在部门",dataIndex:"departmentName",hideInSearch:!0,align:"center",width:180},{title:"所属角色",dataIndex:"roleNames",align:"center",hideInSearch:!0,width:220,bodyCell:({record:e})=>{let t;return i(m,null,re(t=e.roleNames.map((e=>i(c,{color:"success",key:e},re(e)?e:{default:()=>[e]}))))?t:{default:()=>[t]})}},{title:"呢称",width:120,align:"center",dataIndex:"nickName"},{title:"邮箱",width:120,align:"center",dataIndex:"email"},{title:"手机",width:120,align:"center",dataIndex:"phone"},{title:"备注",width:120,align:"center",dataIndex:"remark"},{title:"状态",dataIndex:"status",width:100,formItemProps:{component:"Select",componentProps:{options:[{label:"启用",value:1},{label:"禁用",value:0}]}},bodyCell:({record:e})=>{const t=1===e.status;return i(c,{color:t?"success":"red"},{default:()=>[t?"启用":"禁用"]})}}],ie={class:"flex justify-between"},ue=o("div",null,"组织架构",-1),ce=s("新增部门 "),pe=s("刷新 "),me=s(" 编辑 "),fe=s(" 删除 "),ye=s("取消选择"),he=s(" 新增 "),ve=s(" 转移 "),be=s(" 删除 ");e("default",t({name:"SystemUser",setup(e){const[t]=U(),l=a(!1),d=a(),r=f({expandedKeys:[],departmentIds:[],deptTree:[]}),u=a({selectedRowKeys:[],onChange:(e,t)=>{u.value.selectedRowKeys=e}}),c=y((()=>u.value.selectedRowKeys.length)),p=async(e={})=>{var a,l,n;const[d]=await t({modalProps:{title:(e.id?"编辑":"新增")+"部门",width:700,onFinish:async t=>{t.id=e.id,await(e.id?V:A)(t),G()}},formSchema:{labelWidth:100,layout:"vertical",schemas:le}});null===(a=d.value)||void 0===a||a.updateSchema([{field:"parentId",componentProps:{treeDefaultExpandedKeys:[-1].concat((null==e?void 0:e.keyPath)||[]),treeData:[{value:-1,title:"#",children:r.deptTree}]}}]),null===(l=d.value)||void 0===l||l.setFieldsValue({...e,parentId:null!==(n=e.parentId)&&void 0!==n?n:-1})},M=async()=>{var e;const[a]=await t({modalProps:{title:"转移部门",width:700,onFinish:async e=>{await L({departmentId:e.departmentId,userIds:u.value.selectedRowKeys.map((e=>e))})}},formSchema:{labelWidth:100,layout:"vertical",schemas:oe}});null===(e=a.value)||void 0===e||e.updateSchema([{field:"departmentId",componentProps:{treeData:r.deptTree}}])},Q=async(e={})=>{var a,l,n;const[o]=await t({modalProps:{title:(e.id?"编辑":"新增")+"用户",width:700,onFinish:async t=>{var a;t.id=e.id,await(e.id?te:ee)(t),null===(a=d.value)||void 0===a||a.refreshTable()}},formSchema:{labelWidth:100,layout:"vertical",schemas:ne}});if(null===(a=o.value)||void 0===a||a.updateSchema([{field:"departmentId",componentProps:{treeDefaultExpandedKeys:(null===(l=X(null==e?void 0:e.departmentId,r.deptTree))||void 0===l?void 0:l.keyPath)||[],treeData:r.deptTree}}]),null===(n=o.value)||void 0===n||n.setFieldsValue(e),null!=e&&e.id){var s;const{roles:t}=await(i={userId:e.id},F({url:D.info,method:"get",params:i}));null===(s=o.value)||void 0===s||s.setFieldsValue({roles:t})}var i},B=async e=>{await t({modalProps:{title:`修改密码(${e.username})`,width:700,onFinish:async t=>{var a;await(a={userId:e.id,password:t.password},F({url:D.password,method:"post",data:a},{successMsg:"操作成功"}))}},formSchema:{labelWidth:100,layout:"vertical",schemas:de}})},G=async()=>{l.value=!0;const e=await W().finally((()=>l.value=!1));r.deptTree=z(e),r.expandedKeys=[...r.expandedKeys,...r.deptTree.map((e=>Number(e.key)))]};G();const H=async e=>{var t;Array.isArray(e)?R.confirm({title:"确定要删除所选的用户吗?",icon:i($,null,null),centered:!0,onOk:async()=>{await ae({userIds:e}),G()}}):await ae({userIds:[e]}).finally(null===(t=d.value)||void 0===t?void 0:t.refreshTable)},Y=e=>{var t,a;r.departmentIds=e,null==d||null===(t=d.value)||void 0===t||null===(a=t.refreshTable)||void 0===a||a.call(t)},J=async({page:e,limit:t})=>{const a=await function(e){return F({url:D.page,method:"post",data:e})}({page:e,limit:t,departmentIds:r.departmentIds.length?r.departmentIds:void 0});return u.value.selectedRowKeys=[],a},re=[...se,{title:"操作",width:220,dataIndex:"$action",align:"center",fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"sys.user.update",effect:"disable"},onClick:()=>Q(e)},{label:"改密",auth:"sys.user.password",onClick:()=>B(e)},{label:"删除",auth:"sys.user.delete",popConfirm:{title:"你确定要删除吗？",onConfirm:()=>H(e.id)}}]}];return(e,t)=>{const a=h("a-button");return n(),v(w(Z),null,{"left-content":b((()=>[o("div",ie,[ue,i(w(m),null,{default:b((()=>[e.$auth("sys.dept.add")?(n(),v(w(g),{key:0,placement:"top"},{title:b((()=>[ce])),default:b((()=>[i(w(x),{onClick:t[0]||(t[0]=e=>p({}))})])),_:1})):I("",!0),i(w(g),{placement:"top"},{title:b((()=>[pe])),default:b((()=>[i(w(k),{spin:l.value,onClick:G},null,8,["spin"])])),_:1})])),_:1})]),i(w(_),{expandedKeys:w(r).expandedKeys,"onUpdate:expandedKeys":t[1]||(t[1]=e=>w(r).expandedKeys=e),autoExpandParent:"","tree-data":w(r).deptTree,onSelect:Y},{title:b((({key:t,title:a,formData:l})=>[i(w(C),{trigger:["contextmenu"]},{overlay:b((()=>[i(w(P),null,{default:b((()=>[i(w(P).Item,{key:"1",disabled:!e.$auth("sys.dept.update"),onClick:e=>p(l)},{default:b((()=>[me,i(w(S))])),_:2},1032,["disabled","onClick"]),i(w(P).Item,{key:"2",disabled:!e.$auth("sys.dept.delete"),onClick:e=>{return a=t,void R.confirm({title:"确定要删除该部门吗?",icon:i($,null,null),centered:!0,onOk:async()=>{await O({departmentId:a}),G()}});var a}},{default:b((()=>[fe,i(w(T))])),_:2},1032,["disabled","onClick"])])),_:2},1024)])),default:b((()=>[o("span",null,K(a),1)])),_:2},1024)])),_:1},8,["expandedKeys","tree-data"])])),"right-content":b((()=>[i(w(N),{ref_key:"dynamicTableRef",ref:d,"header-title":"用户管理","show-index":"",titleTooltip:"请不要随意删除用户，避免到影响其他用户的使用。","data-request":J,columns:re,scroll:{x:2e3},"row-selection":u.value},E({toolbar:b((()=>[i(a,{type:"primary",disabled:!e.$auth("sys.user.add"),onClick:t[3]||(t[3]=e=>Q({}))},{default:b((()=>[i(w(x)),he])),_:1},8,["disabled"]),i(a,{type:"success",disabled:!w(c)||!e.$auth("sys.dept.transfer"),onClick:M},{default:b((()=>[i(w(q)),ve])),_:1},8,["disabled"]),i(a,{type:"danger",disabled:!w(c)||!e.$auth("sys.user.delete"),onClick:t[4]||(t[4]=e=>H(u.value.selectedRowKeys))},{default:b((()=>[i(w(T)),be])),_:1},8,["disabled"])])),_:2},[w(c)?{name:"title",fn:b((()=>[i(w(j),{class:"w-full",type:"info","show-icon":""},{message:b((()=>[s(" 已选 "+K(w(c))+" 项 ",1),i(a,{type:"link",onClick:t[2]||(t[2]=e=>u.value.selectedRowKeys=[])},{default:b((()=>[ye])),_:1})])),_:1})]))}:void 0]),1032,["row-selection"])])),_:1})}}}))}}}))}();
